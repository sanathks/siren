# Draph - LLM Integration Guide

Draph is a visual diagram editor at https://draph.sanath.dev

## API Endpoints

### POST /api/diagram
Create diagram, returns shareable URL.

```bash
curl -X POST https://draph.sanath.dev/api/diagram \
  -H "Content-Type: application/json" \
  -d '{"nodes": [...], "connections": [...]}'
```

Response: `{"url": "https://draph.sanath.dev/d/abc123", ...}`

**Always share the short `url`, not the long `editUrl`.**

### POST /api/diagram/image  
Export as PNG. Same body as above, returns image binary.

---

## Node Types

| Type | Description | Default Size | Mermaid Syntax |
|------|-------------|--------------|----------------|
| `rect` | Rectangle | 120×44 | `A[Label]` |
| `pill` | Rounded rectangle | 120×44 | `A(Label)` |
| `diamond` | Decision/condition | 80×60 | `A{Label}` |
| `circle` | Terminal/event | 80×80 | `A((Label))` |
| `container` | Group box (dashed border) | 280×180 | `A[["Label"]]` |
| `text` | Free text annotation | 100×24 | - |
| `line` | Standalone arrow | 100×0 | - |

---

## Node Properties

```json
{
  "id": "n1",
  "type": "rect",
  "label": "My Node",
  "x": 100,
  "y": 100,
  "width": 120,
  "height": 44,
  "color": "#7aa2f7",
  "outlineColor": "#414868",
  "fillStyle": "infill"
}
```

### All Node Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `type` | string | Yes | `rect`, `pill`, `diamond`, `circle`, `container`, `text`, `line` |
| `label` | string | No | Display text |
| `x` | number | Yes | X position in pixels |
| `y` | number | Yes | Y position in pixels |
| `width` | number | No | Width in pixels |
| `height` | number | No | Height in pixels |
| `color` | hex | No | Fill color. **Omit for no fill (don't use "transparent")** |
| `outlineColor` | hex | No | Border/stroke color |
| `fillStyle` | string | No | Fill pattern (see below) |
| `lineStyle` | string | No | For `line` type: `solid` or `dashed` |

### fillStyle Property

**Property name is `fillStyle` (not `fill`)**

| Value | Description |
|-------|-------------|
| `"outline"` | Transparent fill, border only |
| `"infill"` | Solid color fill (default) |
| `"stripe"` | Diagonal stripe pattern |
| `"grid"` | Dot grid pattern |

Example:
```json
{"id": "n1", "type": "rect", "label": "Striped", "x": 100, "y": 100, "fillStyle": "stripe", "color": "#7aa2f7"}
```

---

## Connection Properties

```json
{
  "id": "c1",
  "from": "n1",
  "to": "n2",
  "label": "next",
  "color": "#414868",
  "strokeStyle": "solid"
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier |
| `from` | string | Yes | Source node ID |
| `to` | string | Yes | Target node ID |
| `label` | string | No | Edge label text |
| `color` | hex | No | Line color |
| `strokeStyle` | string | No | `solid` or `dashed` |
| `lineStyle` | string | No | Alias for strokeStyle |

---

## Container/Grouping

Containers create visual group boxes with dashed borders.

**Important:** Define containers BEFORE the nodes they contain (render order).

```json
{
  "nodes": [
    {"id": "g1", "type": "container", "label": "Input Layer", "x": 50, "y": 50, "width": 400, "height": 150, "outlineColor": "#9ece6a"},
    {"id": "n1", "type": "rect", "label": "Node A", "x": 70, "y": 100, "width": 100, "height": 44},
    {"id": "n2", "type": "rect", "label": "Node B", "x": 200, "y": 100, "width": 100, "height": 44}
  ]
}
```

Container tips:
- Set `outlineColor` for visible border and label
- Omit `color` property (no fill needed)
- Label appears in top-left corner
- Use `fillStyle: "outline"` (default for containers)

---

## Sequence Diagrams

For sequence diagrams, nodes can have lifelines and connections become horizontal messages.

### Sequence Node Properties

| Property | Type | Description |
|----------|------|-------------|
| `isParticipant` | boolean | Mark as sequence participant |
| `hasLifeline` | boolean | Show vertical dashed lifeline below |
| `isActor` | boolean | Render as actor (stick figure) |

### Sequence Connection Properties

| Property | Type | Description |
|----------|------|-------------|
| `isSequenceMessage` | boolean | Render as horizontal message line |
| `messageY` | number | Y position of the message line |
| `index` | number | Message order (for vertical positioning) |
| `arrow` | string | Arrow style: `->>`, `-->>`, `-)`, `--)` |

Arrow types:
- `->>` Solid arrow, filled head
- `-->>` Dashed arrow, filled head  
- `-)` Solid arrow, open head (async)
- `--)` Dashed arrow, open head (async)

### Sequence Example

```json
{
  "nodes": [
    {"id": "a", "type": "rect", "label": "Alice", "x": 100, "y": 50, "isParticipant": true, "hasLifeline": true},
    {"id": "b", "type": "rect", "label": "Bob", "x": 300, "y": 50, "isParticipant": true, "hasLifeline": true}
  ],
  "connections": [
    {"id": "m1", "from": "a", "to": "b", "label": "Hello", "isSequenceMessage": true, "messageY": 150, "index": 0, "arrow": "->>"},
    {"id": "m2", "from": "b", "to": "a", "label": "Hi!", "isSequenceMessage": true, "messageY": 200, "index": 1, "arrow": "-->>"}
  ]
}
```

---

## Class Diagrams

For UML class diagrams with properties and methods.

### Class Node Properties

| Property | Type | Description |
|----------|------|-------------|
| `isClass` | boolean | Render as UML class box |
| `properties` | string[] | List of properties (e.g., `["+name: string", "-id: int"]`) |
| `methods` | string[] | List of methods (e.g., `["+getName()", "-setId(int)"]`) |

Visibility prefixes: `+` public, `-` private, `#` protected, `~` package

### Class Example

```json
{
  "nodes": [
    {
      "id": "user",
      "type": "rect",
      "label": "User",
      "x": 100,
      "y": 100,
      "width": 150,
      "height": 120,
      "isClass": true,
      "properties": ["+name: string", "+email: string", "-password: string"],
      "methods": ["+login()", "+logout()", "-hashPassword()"]
    }
  ]
}
```

---

## Color Palette (Tokyo Night Storm)

| Name | Hex | Usage |
|------|-----|-------|
| Blue | `#7aa2f7` | Primary accent |
| Cyan | `#7dcfff` | Secondary accent |
| Green | `#9ece6a` | Success, Layer 1 |
| Red | `#f7768e` | Error, danger |
| Yellow | `#e0af68` | Warning, decisions |
| Magenta | `#bb9af7` | Special, Layer 3 |
| Orange | `#ff9e64` | Attention, output |
| Foreground | `#c0caf5` | Text, light borders |
| Border | `#414868` | Default borders |
| Background | `#24283b` | Canvas background |

---

## Mermaid Syntax Support

The API accepts Mermaid code via `{"mermaid": "..."}`:

### Flowchart
```
flowchart TD
  A[Rectangle] --> B(Pill)
  B --> C{Diamond}
  C -->|Yes| D((Circle))
  C -->|No| E[End]
```

Directions: `TD` (top-down), `LR` (left-right), `RL`, `BT`

### Sequence Diagram
```
sequenceDiagram
  participant A as Alice
  participant B as Bob
  A->>B: Hello
  B-->>A: Hi
  loop Every minute
    A->>B: Ping
  end
```

### Class Diagram
```
classDiagram
  class User {
    +String name
    +login()
  }
  User <|-- Admin
```

---

## Complete Example: Architecture Diagram with Groups

```json
{
  "nodes": [
    {"id": "g1", "type": "container", "label": "Frontend", "x": 50, "y": 50, "width": 300, "height": 150, "outlineColor": "#9ece6a"},
    {"id": "n1", "type": "rect", "label": "React App", "x": 80, "y": 100, "width": 100, "height": 44},
    {"id": "n2", "type": "rect", "label": "Next.js", "x": 200, "y": 100, "width": 100, "height": 44},
    
    {"id": "g2", "type": "container", "label": "Backend", "x": 50, "y": 230, "width": 300, "height": 150, "outlineColor": "#7aa2f7"},
    {"id": "n3", "type": "rect", "label": "API Server", "x": 80, "y": 280, "width": 100, "height": 44},
    {"id": "n4", "type": "pill", "label": "Auth", "x": 200, "y": 280, "width": 100, "height": 44},
    
    {"id": "n5", "type": "circle", "label": "DB", "x": 400, "y": 280, "width": 60, "height": 60, "color": "#bb9af7"}
  ],
  "connections": [
    {"id": "c1", "from": "n1", "to": "n3"},
    {"id": "c2", "from": "n2", "to": "n3"},
    {"id": "c3", "from": "n3", "to": "n4"},
    {"id": "c4", "from": "n4", "to": "n5"}
  ]
}
```

---

## Tips

1. **Containers first** - Define containers before contained nodes
2. **No "transparent"** - Omit `color` instead of setting `"transparent"`
3. **fillStyle not fill** - Use `fillStyle` property for patterns
4. **outlineColor for containers** - Sets both border and label color
5. **Spacing** - Use multiples of 20px for grid alignment
6. **Short URLs** - Always share the `url` field, not `editUrl`

---

## MCP Server

For Claude Desktop integration:

```json
{
  "mcpServers": {
    "draph": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "https://draph.sanath.dev/mcp"]
    }
  }
}
```

Tools: `create_diagram`, `create_diagram_json`, `export_diagram_image`
